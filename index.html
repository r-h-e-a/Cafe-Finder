<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>ONE STOP GRUB üç∞üç¥üç¶</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <!-- Leaflet Routing Machine CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css" />

  <style>
    body, html {
      margin: 0;
      padding: 0;
      font-family: 'Comic Sans MS', cursive, sans-serif;
      background: #fff0f5;
    }

    #mapContainer { display: flex; height: 100vh; width: 100%; }
    #map { flex: 3; }
    #sidebar {
      flex: 1;
      background: #ffe4e1;
      padding: 20px;
      overflow-y: auto;
      box-shadow: -2px 0 5px rgba(0,0,0,0.1);
    }
    #sidebar h2 { text-align: center; color: #d147a3; }
    .place-item {
      padding: 10px;
      margin: 5px 0;
      border-radius: 10px;
      cursor: pointer;
      color: white;
      font-weight: bold;
      transition: transform 0.2s;
    }
    .cafe-item { background: #ffb6c1; }
    .cafe-item:hover { transform: scale(1.05); background: #ff69b4; }
    .restaurant-item { background: #87ceeb; }
    .restaurant-item:hover { transform: scale(1.05); background: #1e90ff; }
    .dessert-item { background: #ffcc99; }
    .dessert-item:hover { transform: scale(1.05); background: #ff9966; }
    .leaflet-popup-content { font-size: 14px; }

    /* Controls */
    #controls {
      text-align: center;
      margin-bottom: 15px;
    }
    #controls input {
      width: 60px;
      padding: 5px;
      border-radius: 10px;
      border: 2px solid #ff69b4;
      text-align: center;
      margin-right: 5px;
    }
    #controls button {
      padding: 6px 12px;
      border: none;
      border-radius: 10px;
      background: #ff69b4;
      color: white;
      cursor: pointer;
      font-weight: bold;
    }
    #controls button:hover { background: #d147a3; }

    /* Welcome overlay */
    #welcome {
      position: fixed; top:0; left:0; width:100%; height:100%;
      background: url("img.jpeg") no-repeat center center/cover;
      display:flex; justify-content:center; align-items:center;
      flex-direction:column; z-index:9999; text-align:center; color:#fff;
      overflow:hidden;
    }
    #welcome h1.title {
      color: #ff69b4;
      font-size: 3em;
      margin-bottom: 10px;
      text-shadow: 2px 2px 5px #000;
      font-weight: bold;
    }
    #welcome p.subtitle {
      color: #ff69b4;
      font-weight: bold;
      font-size: 1.5em;
      text-shadow: 1px 1px 3px #000;
      margin-bottom: 30px;
    }
    #welcome button {
      padding:15px 30px; font-size:1.2em;
      border:none; border-radius:15px; background:#ff69b4;
      color:white; cursor:pointer; box-shadow:0 5px 10px rgba(0,0,0,0.2);
      transition: transform 0.2s;
    }
    #welcome button:hover { transform: scale(1.1); }

    /* Floating ribbons */
    .ribbon {
      position: absolute;
      font-size: 50px;
      animation: floatUp linear infinite;
    }
    @keyframes floatUp {
      0% { transform: translateY(0) rotate(0deg); opacity: 1; }
      50% { opacity: 0.8; }
      100% { transform: translateY(-100vh) rotate(360deg); opacity: 0; }
    }
  </style>
</head>
<body>

<div id="welcome">
  <h1 class="title">ONE STOP GRUB</h1>
  <p class="subtitle">The yummiest spots around you, mapped!!‚òïüç¥üç¶</p>
  <button id="startBtn">Find Places Near Me!</button>
</div>

<div id="mapContainer" style="display:none;">
  <div id="map"></div>
  <div id="sidebar">
    <h2>Nearby Places</h2>

    <div id="controls">
      <label for="radiusInput">Radius (km):</label>
      <input type="number" id="radiusInput" value="5" min="1" max="20" />
      <button onclick="updateRadius()">Update</button>
    </div>

    <h3>Cafes</h3><div id="cafeList"></div>
    <h3>Restaurants</h3><div id="restaurantList"></div>
    <h3>Dessert/Ice Cream</h3><div id="dessertList"></div>
  </div>
</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<!-- Leaflet Routing Machine JS -->
<script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>

<script>
  // üéÄ Floating ribbons
  const ribbonEmojis = ["üéÄ","‚ú®"];
  const welcome = document.getElementById('welcome');
  function createRibbon(){
    const ribbon = document.createElement('div');
    ribbon.className='ribbon';
    ribbon.textContent=ribbonEmojis[Math.floor(Math.random()*ribbonEmojis.length)];
    ribbon.style.left=Math.random()*100+'vw';
    ribbon.style.animationDuration=(5+Math.random()*5)+'s';
    welcome.appendChild(ribbon);
    setTimeout(()=>ribbon.remove(),10000);
  }
  setInterval(createRibbon,500);

  // üåç Map init
  const map = L.map('map');
  const cafeListEl = document.getElementById('cafeList');
  const restaurantListEl = document.getElementById('restaurantList');
  const dessertListEl = document.getElementById('dessertList');

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution:'¬© OpenStreetMap contributors' }).addTo(map);

  const cafeIcon = L.icon({iconUrl:'https://cdn-icons-png.flaticon.com/512/2965/2965567.png', iconSize:[30,30]});
  const restaurantIcon = L.icon({iconUrl:'https://cdn-icons-png.flaticon.com/512/3075/3075977.png', iconSize:[30,30]});
  const dessertIcon = L.icon({iconUrl:'https://cdn-icons-png.flaticon.com/512/2910/2910766.png', iconSize:[30,30]});

  let userLat, userLon, routingControl;
  let searchRadius = 5000; // default 5 km
  let placesLayer = L.layerGroup().addTo(map); // all place markers

  function updateRadius(){
    const km = document.getElementById("radiusInput").value;
    searchRadius = km * 1000;
    if(userLat && userLon){
      fetchPlaces(userLat, userLon);
    }
  }

  function fetchPlaces(lat, lon){
    cafeListEl.innerHTML='';
    restaurantListEl.innerHTML='';
    dessertListEl.innerHTML='';
    placesLayer.clearLayers(); // ‚úÖ remove old markers

    const query=`
      [out:json];
      (
        node["amenity"="cafe"](around:${searchRadius},${lat},${lon});
        node["amenity"="restaurant"](around:${searchRadius},${lat},${lon});
        node["amenity"="ice_cream"](around:${searchRadius},${lat},${lon});
        node["shop"="dessert"](around:${searchRadius},${lat},${lon});
      );
      out;
    `;
    const url="https://overpass-api.de/api/interpreter?data="+encodeURIComponent(query);

    fetch(url).then(res=>res.json()).then(data=>{
      const cafes=data.elements.filter(el=>el.tags?.name && el.tags.amenity==="cafe");
      const restaurants=data.elements.filter(el=>el.tags?.name && el.tags.amenity==="restaurant");
      const desserts=data.elements.filter(el=>el.tags?.name && (el.tags.amenity==="ice_cream" || el.tags.shop==="dessert"));

      cafes.forEach(el=>{
        const marker=L.marker([el.lat,el.lon],{icon:cafeIcon}).bindPopup(`<b>${el.tags.name}</b><br>‚òï Cafe`);
        placesLayer.addLayer(marker);
        const item=document.createElement('div'); item.className='place-item cafe-item'; item.textContent=`‚òï ${el.tags.name}`;
        item.onclick=()=>{ map.setView([el.lat,el.lon],17); marker.openPopup(); goToPlace(el.lat,el.lon); };
        cafeListEl.appendChild(item);
      });

      restaurants.forEach(el=>{
        const marker=L.marker([el.lat,el.lon],{icon:restaurantIcon}).bindPopup(`<b>${el.tags.name}</b><br>üç¥ Restaurant`);
        placesLayer.addLayer(marker);
        const item=document.createElement('div'); item.className='place-item restaurant-item'; item.textContent=`üç¥ ${el.tags.name}`;
        item.onclick=()=>{ map.setView([el.lat,el.lon],17); marker.openPopup(); goToPlace(el.lat,el.lon); };
        restaurantListEl.appendChild(item);
      });

      desserts.forEach(el=>{
        const marker=L.marker([el.lat,el.lon],{icon:dessertIcon}).bindPopup(`<b>${el.tags.name}</b><br>üç¶ Dessert`);
        placesLayer.addLayer(marker);
        const item=document.createElement('div'); item.className='place-item dessert-item'; item.textContent=`üç¶ ${el.tags.name}`;
        item.onclick=()=>{ map.setView([el.lat,el.lon],17); marker.openPopup(); goToPlace(el.lat,el.lon); };
        dessertListEl.appendChild(item);
      });

      if(cafes.length===0) cafeListEl.innerHTML='<p>No named cafes nearby üò¢</p>';
      if(restaurants.length===0) restaurantListEl.innerHTML='<p>No named restaurants nearby üò¢</p>';
      if(desserts.length===0) dessertListEl.innerHTML='<p>No named desserts nearby üò¢</p>';
    }).catch(err=>console.error(err));
  }

  function goToPlace(lat, lon){
    if(routingControl) map.removeControl(routingControl);
    routingControl=L.Routing.control({
      waypoints:[L.latLng(userLat,userLon), L.latLng(lat,lon)],
      routeWhileDragging:false,
      draggableWaypoints:false,
      addWaypoints:false
    }).addTo(map);
  }

  // üöÄ Start button
  document.getElementById('startBtn').addEventListener('click',()=>{
    welcome.style.display='none';
    document.getElementById('mapContainer').style.display='flex';
    map.setView([28.6139,77.2090],14);
    map.locate({setView:true,maxZoom:16});

    map.on("locationfound", e=>{
      userLat=e.latitude; userLon=e.longitude;
      L.marker(e.latlng).addTo(map).bindPopup("üìç You are here").openPopup();
      fetchPlaces(userLat,userLon);
    });

    map.on("locationerror", ()=>{
      alert("Could not detect your location. Showing default (New Delhi).");
      userLat=28.6139; userLon=77.2090;
      fetchPlaces(userLat,userLon);
    });
  });
</script>

</body>
</html>
